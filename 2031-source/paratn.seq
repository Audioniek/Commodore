 .PAGE 'PARATN'ATNIRQ LDA PA1 LDA #$01 STA ATNPND RTS;;; ; ATNSRV SEI LDA #$00 ;CLEAR PENDING FLAG STA ATNPND LDX #$45 TXS LDA #%01001100 ORA PB AND #%11101101 STA PB LDA #$00 STA DDRA1 LDA #%00010111 STA DDRB1 LDA #$FF STA PA1LE8AA LDA PB AND #%11111011 ORA #%00000011 STA PBLE8B4 BIT PB BVC LE8BD BMI LE8B4 BPL LE93A;LE8BD LDA #%11111101 AND PB STA PB AND #%00001000 STA EOIFLG LDA PA1 ;GET BUS DATA EOR #$FF ;INVERT IT STA ICMD ;AND STORE BUS COMMAND LDA #%00000100 ;GET BIT MASK ORA PB STA PB LDY #$00 LDA ICMD AND #$60 CMP #$40 BEQ LE90B CMP #$20 BEQ LE8EC CMP #$60 BEQ AT50 BNE LE932;LE8EC LDA ICMD ;GET BUS COMMAND CMP LSNADR ;IS IT FOR US BEQ ILSTEN ;YES CMP #$3F ;IF UNLISTEN BNE ATN45 STY LSNACT ;CLEAR LISTEN FLAGATN45 STY ADRSED JMP LE932 ;EVALUATE TALK;**************************************************************************** LISTEN TO IEEE488 BUS? *********************************************************************************ILSTEN STA LSNACT ;SAVE CURRENT LISTEN SA STY TLKACTATN95 LDA #$20 STA SA STA ORGSA STA ADRSED BNE LE932;LE90B STY TLKACT LDA ICMD CMP TLKADR BNE ATN45 STA TLKACT STY LSNACT BEQ ATN95;AT50 LDA ADRSED BEQ LE932 LDA ICMD STA ORGSA PHA AND #$0F STA SA PLA AND #$F0 CMP #$E0 BNE LE932 CLI JSR LDAC0 SEI; EVALUATE TALK?LE932 BIT PB ;WAIT BVC LE932 ;FOR NO... JMP LE8AA ;AND LOOP;LE93A LDA LSNACT ;IF WE BEQ LE94C ;ARE LISTENING LDA #%11111100 AND PB STA PB JSR LISTENA JMP IDLE;LE94C LDA #%11111010 AND PB ORA #%00000100 STA PB LDA TLKACT ;IF WE ARE TALKING BEQ LE95D JSR ITALK ;GO TALKLE95D JMP IDLE