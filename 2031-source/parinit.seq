;********************************************************************************;* **************************************************************************** *;* ############################################## *;* FROM THIS POINT ON CODE DEVIATES FROM THE 1541 *;* ############################################## *;* **************************************************************************** *;* IEEE 488 STUFF? *;********************************************************************************LE77F LDA PB ;GET BUS STATUS ORA #%01000000 ;SET DAV TRUE STA PB ;ON BUS LDA DDRB1 ;SET ALL BUS LINES TO OUTPUT AND #%10111111 ;EXCEPT DAV STA DDRB1 ;AND RTS ;EXIT;; INITIALIZE THE IEEE BUS;BOOT LDA PA1 ;IF DATA ON BUS BNE LE77F ;SET DAV TO INPUT LDA DDRB1 ;SET DAV VIA PIN ORA #$40 ;TO INPUT STA DDRB1 LDA PB ;GET BUS STATUS LINES ORA #%01000000 ;FLOAT DAV LINE STA PB ;ON BUS LDA PB ;GET BUS LINE STATUS AND #%00000010 ;IF NRFD BEQ LE77F ;TRUE, GO LDA PB ;ELSE AND #%10111111 ;SET DAV STA PB ;FALSE LDA PB ;GET BUS LINE STATUS AND #%00000010 ;IF NRFD BNE LE77F ;TRUE, LOOPLE7BB LDA PA1 ;GET BUS DATA BEQ LE7BB ;IF NONE, WAIT FOR SOME INC F2CNT INC CMDSIZ LDA #$2A STA CMDBUF JSR LE77F ;FLOAT DAV LINE JMP BOOT4 ;AND BOOT CODE VIA UTLODR;; .END