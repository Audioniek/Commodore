 .PAGE 'PARTALK';********************************************************************************;* TALK TO IEEE488 BUS *;********************************************************************************ITALK SEI ;FIND IF OPEN CHANNEL JSR FNDRCH BCS NOTLK ;NO ONE HOMETALK1 LDX LINDX LDA CHNRDY,X BMI TLK05NOTLK RTS;;; CODE ADDED TO CORRECT VERIFY ERRORTLK05 LDA #%01011001 ;TEST FOR ATN STA DDRB1 LDA #$FF ;SET DATA STA DDRA1 ;TO OUTPUTS LDA PB ORA #%00010000 STA PB LDA #%00000010TALK2 BIT PB BMI LEA79 ;IS ATN GONE? BEQ TALK2 LDA CHNDAT,X ;GET CHANNEL DATA EOR #$FF ;INVERT IT STA PA1 ;PUT ON BUS LDA CHNRDY,X ;GET CHANNEL STATE ORA #$B7 ;ADD EOI STATE? AND PB ;AND BUS FLAGS STA PB ;AND SET BUS FLAGSISR04 LDA PB ;GET BUS FLAGS BMI LEA79 ;IF ? AND #$06 ;ELSE GET CMP #$06 BEQ ILERR AND #%00000010 BNE ISR04 CLI ;GET NEXT BYTE TO SEND JSR GET ;GET A BYTE FROM CHANNEL SEI LDA #%00000100LEA5A BIT PB BMI LEA79 BEQ LEA5A LDA #$FF ;SET BUS DATA TO ZERO STA PA1 LDA #%01001000 ORA PB STA PB LDA #%00000100 ;GETLEA70 BIT PB BMI LEA79 BNE LEA70 BEQ TALK1 ;KEEP ON TALKIN (BRANCH ALWAYS);LEA79 JMP ATNSRV;LEA7C LDA PB ORA #%01000000 STA PB RTS;TATN20 LDA #%00000010 ORA PB AND #%11111110 STA PB RTS;; END OF IEEE488 STUFF?; ;